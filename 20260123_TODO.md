# Client Sniper - TODO Implementazioni
**Data creazione:** 2026-01-23
**Obiettivo:** Rendere Client Sniper uno strumento INDISPENSABILE per freelancer e web agency

---

# STATO AVANZAMENTO

## Legenda
- [ ] Da fare
- [x] Completato
- [~] In corso
- [!] Bloccato

---

# PRIORITA 0: CREDIT PACKS (Richiesta utente)

## Descrizione
Permettere acquisto di crediti singoli "a gettone" senza sottoscrizione mensile.

### Pacchetti proposti
| Pacchetto | Crediti | Prezzo | Prezzo/credito | Sconto |
|-----------|---------|--------|----------------|--------|
| Micro | 5 | €4.99 | €1.00 | - |
| Small | 15 | €12.99 | €0.87 | 13% |
| Medium | 50 | €39.99 | €0.80 | 20% |
| Large | 100 | €69.99 | €0.70 | 30% |
| XL | 250 | €149.99 | €0.60 | 40% |

### Task
- [ ] **DB**: Creare tabella `credit_packs` e `credit_purchases` (SQL pronto sotto)
- [x] **Backend**: API per acquisto credit pack (`/api/credits/purchase/route.ts`)
- [ ] **Stripe**: Creare prodotti one-time in Stripe Dashboard
- [x] **Frontend**: UI pagina acquisto crediti (`/app/credits/page.tsx`)
- [x] **Frontend**: Link "Ricarica crediti" in Navbar
- [x] **Webhook**: Gestione pagamento completato (`handleCreditPackPurchase`)

---

# SPRINT 1: UI Quick Wins (Dashboard)

## 1.1 Bulk Actions
- [ ] Checkbox selection per ogni lead nella lista
- [ ] State management per lead selezionati
- [ ] BulkActionsBar component (sticky top quando selection > 0)
- [ ] Azione: Esporta CSV
- [ ] Azione: Esporta Excel
- [ ] Azione: Bulk tag
- [ ] Azione: Bulk status change (CRM)

## 1.2 Rich List Columns
- [ ] Aggiungere colonna "Categoria"
- [ ] Aggiungere colonna "Citta"
- [ ] Aggiungere colonna "Contatti" (icone email/phone)
- [ ] Aggiungere colonna "CRM Status" (badge colorato)
- [ ] Badge "Hot" per score > 80 con email
- [ ] Colori score (verde/giallo/rosso)

## 1.3 Smart Filters Sidebar
- [ ] Componente SmartFiltersSidebar
- [ ] Quick filter: "Hot Leads" (score > 80)
- [ ] Quick filter: "Con Email"
- [ ] Quick filter: "Nuovi oggi"
- [ ] Quick filter: "Follow-up scaduti"
- [ ] Sezione "Ricerche Salvate"

## 1.4 View Switcher
- [ ] Componente ViewSwitcher
- [ ] Vista Lista (default)
- [ ] Vista Grid (cards)
- [ ] Vista Kanban (integra CRMKanban)
- [ ] Persistenza view preference

## 1.5 Export Dropdown
- [ ] Componente ExportDropdown
- [ ] Export CSV con selezione colonne
- [ ] Export Excel formattato
- [ ] Export per Mailchimp
- [ ] Export per HubSpot

---

# SPRINT 2: PricingEngine & Lead Detail

## 2.1 PricingEngine
- [ ] Creare `services/scraping-engine/src/pricing/pricing-engine.ts`
- [ ] Interface ServiceQuotation
- [ ] Interface Quotation
- [ ] Moltiplicatori complessita (CMS)
- [ ] Moltiplicatori categoria
- [ ] Prezzi base servizi
- [ ] Metodo generateQuotation()
- [ ] Metodo calculateROI()
- [ ] Test unitari

## 2.2 Lead Detail Redesign
- [ ] Hero section (score + opportunity)
- [ ] Sidebar con quick actions
- [ ] Contact info prominente
- [ ] Tab system refactoring
- [ ] Tab "Preventivo" (nuovo)
- [ ] Tab "Competitors" (integrare CompetitorSection)
- [ ] Timeline sidebar

## 2.3 PDF Preventivo
- [ ] Template PDF preventivo
- [ ] API endpoint generazione
- [ ] Download button in UI
- [ ] Invio via email

---

# SPRINT 3: Email Outreach

## 3.1 OutreachEmailGenerator
- [ ] Creare `services/scraping-engine/src/outreach/email-generator.ts`
- [ ] Interface EmailTemplate
- [ ] Template: Cold Email SEO
- [ ] Template: Cold Email Performance
- [ ] Template: Cold Email Security
- [ ] Template: Cold Email GDPR
- [ ] Template: Cold Email Full Audit
- [ ] Template: Follow-up 1
- [ ] Template: Follow-up 2
- [ ] Template: LinkedIn Message
- [ ] Sistema variabili personalizzazione

## 3.2 UI Email Outreach
- [ ] Modale invio email da lead detail
- [ ] Selezione template
- [ ] Preview email con variabili sostituite
- [ ] Editor custom message
- [ ] Pulsante invio

## 3.3 Bulk Email
- [ ] UI selezione lead per bulk email
- [ ] Preview campagna
- [ ] Invio con delay (anti-spam)
- [ ] Progress indicator

## 3.4 Email Tracking
- [ ] Pixel tracking aperture
- [ ] Click tracking link
- [ ] Visualizzazione in timeline lead
- [ ] Dashboard statistiche email

---

# SPRINT 4: Team Management & API

## 4.1 Database Teams
- [ ] Tabella `teams`
- [ ] Tabella `team_members`
- [ ] Tabella `lead_assignments`
- [ ] Tabella `api_keys`
- [ ] Tabella `webhooks`

## 4.2 Team Management UI
- [ ] Pagina /team
- [ ] Lista membri
- [ ] Invita membro (email)
- [ ] Gestione ruoli
- [ ] Rimuovi membro

## 4.3 Lead Assignment
- [ ] Dropdown "Assign to" in lead detail
- [ ] Filtro "My Leads"
- [ ] Vista assegnazioni team
- [ ] Notifica quando assegnato

## 4.4 API Pubblica
- [ ] Endpoint GET /api/public/leads
- [ ] Endpoint GET /api/public/leads/:id
- [ ] Endpoint PUT /api/public/crm/:id
- [ ] Autenticazione API Key
- [ ] Rate limiting
- [ ] UI gestione API keys

## 4.5 Webhooks
- [ ] Sistema webhook events
- [ ] UI configurazione webhooks
- [ ] Event: lead.unlocked
- [ ] Event: crm.status_changed
- [ ] Event: crm.follow_up_due
- [ ] Log chiamate webhook

---

# SPRINT 5: Mobile & Polish

## 5.1 Mobile Optimization
- [ ] Dashboard responsive
- [ ] Lead detail responsive
- [ ] Bottom sheet per filtri (mobile)
- [ ] Touch gestures Kanban

## 5.2 Notification Center
- [ ] Componente NotificationCenter
- [ ] Bell icon navbar
- [ ] Dropdown notifiche
- [ ] Badge count
- [ ] Tipi: score update, follow-up, email opened

## 5.3 Onboarding
- [ ] Tour guidato migliorato
- [ ] Tooltip contestuali
- [ ] Checklist primo utilizzo

---

# QUERY SQL - DA ESEGUIRE SU SUPABASE

## 1. Credit Packs (PRIORITA 0)

```sql
-- Tabella pacchetti crediti disponibili
CREATE TABLE credit_packs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  credits INTEGER NOT NULL,
  price_cents INTEGER NOT NULL,
  currency TEXT DEFAULT 'eur',
  stripe_price_id TEXT,
  discount_percentage INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Inserisci pacchetti default
INSERT INTO credit_packs (name, credits, price_cents, stripe_price_id, discount_percentage, sort_order) VALUES
  ('Micro', 5, 499, NULL, 0, 1),
  ('Small', 15, 1299, NULL, 13, 2),
  ('Medium', 50, 3999, NULL, 20, 3),
  ('Large', 100, 6999, NULL, 30, 4),
  ('XL', 250, 14999, NULL, 40, 5);

-- Storico acquisti crediti
CREATE TABLE credit_purchases (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  credit_pack_id UUID REFERENCES credit_packs(id),
  credits_purchased INTEGER NOT NULL,
  amount_paid_cents INTEGER NOT NULL,
  currency TEXT DEFAULT 'eur',
  stripe_payment_intent_id TEXT,
  stripe_checkout_session_id TEXT,
  status TEXT DEFAULT 'pending', -- pending, completed, failed, refunded
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  completed_at TIMESTAMP WITH TIME ZONE
);

-- Indici
CREATE INDEX idx_credit_purchases_user ON credit_purchases(user_id);
CREATE INDEX idx_credit_purchases_status ON credit_purchases(status);
```

## 2. Team Management (Sprint 4)

```sql
-- Tabella team/workspace
CREATE TABLE teams (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  owner_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  plan TEXT DEFAULT 'agency',
  max_members INTEGER DEFAULT 5,
  settings JSONB DEFAULT '{}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Membri del team
CREATE TABLE team_members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID NOT NULL REFERENCES teams(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  role TEXT DEFAULT 'member', -- owner, admin, member
  permissions JSONB DEFAULT '{"can_view_all_leads": false, "can_export": true, "can_delete": false}',
  invited_by UUID REFERENCES users(id),
  invited_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  joined_at TIMESTAMP WITH TIME ZONE,
  status TEXT DEFAULT 'pending', -- pending, active, suspended
  UNIQUE(team_id, user_id)
);

-- Assegnazione lead a membri
CREATE TABLE lead_assignments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  lead_id UUID NOT NULL REFERENCES leads(id) ON DELETE CASCADE,
  team_id UUID NOT NULL REFERENCES teams(id) ON DELETE CASCADE,
  assigned_to UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  assigned_by UUID REFERENCES users(id),
  note TEXT,
  assigned_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(lead_id, team_id)
);

-- Indici
CREATE INDEX idx_team_members_team ON team_members(team_id);
CREATE INDEX idx_team_members_user ON team_members(user_id);
CREATE INDEX idx_lead_assignments_team ON lead_assignments(team_id);
CREATE INDEX idx_lead_assignments_assigned_to ON lead_assignments(assigned_to);
```

## 3. API Keys & Webhooks (Sprint 4)

```sql
-- API Keys per utenti
CREATE TABLE api_keys (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  key_hash TEXT NOT NULL, -- SHA256 hash della key
  key_prefix TEXT NOT NULL, -- Primi 8 caratteri per identificazione
  permissions JSONB DEFAULT '{"read_leads": true, "write_crm": true}',
  rate_limit_per_minute INTEGER DEFAULT 100,
  last_used_at TIMESTAMP WITH TIME ZONE,
  expires_at TIMESTAMP WITH TIME ZONE,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Webhook configurations
CREATE TABLE webhooks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  url TEXT NOT NULL,
  events TEXT[] NOT NULL, -- ['lead.unlocked', 'crm.status_changed']
  secret TEXT, -- Per firma HMAC
  is_active BOOLEAN DEFAULT true,
  last_triggered_at TIMESTAMP WITH TIME ZONE,
  failure_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Log chiamate webhook
CREATE TABLE webhook_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  webhook_id UUID NOT NULL REFERENCES webhooks(id) ON DELETE CASCADE,
  event TEXT NOT NULL,
  payload JSONB NOT NULL,
  response_status INTEGER,
  response_body TEXT,
  duration_ms INTEGER,
  success BOOLEAN,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indici
CREATE INDEX idx_api_keys_user ON api_keys(user_id);
CREATE INDEX idx_api_keys_prefix ON api_keys(key_prefix);
CREATE INDEX idx_webhooks_user ON webhooks(user_id);
CREATE INDEX idx_webhook_logs_webhook ON webhook_logs(webhook_id);
CREATE INDEX idx_webhook_logs_created ON webhook_logs(created_at);
```

## 4. Email Outreach Tracking (Sprint 3)

```sql
-- Email inviate ai lead
CREATE TABLE outreach_emails (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  lead_id UUID NOT NULL REFERENCES leads(id) ON DELETE CASCADE,
  template_id TEXT,
  subject TEXT NOT NULL,
  body_html TEXT,
  body_text TEXT,
  to_email TEXT NOT NULL,
  from_name TEXT,
  status TEXT DEFAULT 'queued', -- queued, sent, delivered, bounced, complained
  tracking_id UUID DEFAULT gen_random_uuid(), -- Per pixel tracking
  opened_at TIMESTAMP WITH TIME ZONE,
  opened_count INTEGER DEFAULT 0,
  clicked_at TIMESTAMP WITH TIME ZONE,
  clicked_count INTEGER DEFAULT 0,
  bounced_at TIMESTAMP WITH TIME ZONE,
  bounce_reason TEXT,
  sent_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Click tracking
CREATE TABLE email_clicks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email_id UUID NOT NULL REFERENCES outreach_emails(id) ON DELETE CASCADE,
  url TEXT NOT NULL,
  clicked_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  user_agent TEXT,
  ip_address TEXT
);

-- Indici
CREATE INDEX idx_outreach_emails_user ON outreach_emails(user_id);
CREATE INDEX idx_outreach_emails_lead ON outreach_emails(lead_id);
CREATE INDEX idx_outreach_emails_tracking ON outreach_emails(tracking_id);
CREATE INDEX idx_email_clicks_email ON email_clicks(email_id);
```

## 5. Notifications (Sprint 5)

```sql
-- Notifiche utente
CREATE TABLE user_notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  type TEXT NOT NULL, -- follow_up_due, email_opened, lead_score_changed, etc
  title TEXT NOT NULL,
  message TEXT,
  data JSONB, -- Dati extra (lead_id, etc)
  read_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indici
CREATE INDEX idx_notifications_user ON user_notifications(user_id);
CREATE INDEX idx_notifications_unread ON user_notifications(user_id, read_at) WHERE read_at IS NULL;
CREATE INDEX idx_notifications_created ON user_notifications(created_at);
```

## 6. Email Templates Salvati (Sprint 3)

```sql
-- Template email personalizzati utente
CREATE TABLE email_templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE, -- NULL = template di sistema
  name TEXT NOT NULL,
  category TEXT DEFAULT 'cold', -- cold, follow_up, proposal, linkedin
  subject TEXT NOT NULL,
  body_html TEXT NOT NULL,
  body_text TEXT,
  variables TEXT[], -- Lista variabili usate
  is_default BOOLEAN DEFAULT false,
  usage_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Inserisci template di sistema
INSERT INTO email_templates (user_id, name, category, subject, body_html, body_text, variables, is_default) VALUES
  (NULL, 'Cold Email - SEO', 'cold',
   'Ho analizzato {website}: {issues_count} problemi SEO trovati',
   '<p>Ciao,</p><p>Ho analizzato <strong>{website}</strong> e ho trovato <strong>{issues_count}</strong> problemi SEO che stanno limitando la tua visibilità su Google.</p><p>Il tuo score attuale è <strong>{score}/100</strong>, mentre la media del settore è 65.</p><p>Il problema principale: <strong>{main_issue}</strong></p><p>Posso aiutarti a risolvere questi problemi in 3 settimane. Vuoi una call di 15 minuti per discuterne?</p><p>Cordiali saluti,<br>{your_name}</p>',
   'Ciao,\n\nHo analizzato {website} e ho trovato {issues_count} problemi SEO...',
   ARRAY['{website}', '{issues_count}', '{score}', '{main_issue}', '{your_name}'],
   true),

  (NULL, 'Cold Email - Performance', 'cold',
   '{website} impiega {load_time}s a caricarsi - perdi il 53% dei visitatori',
   '<p>Ciao,</p><p>Ho fatto un test di velocità su <strong>{website}</strong> e il risultato è preoccupante:</p><ul><li>Tempo di caricamento: <strong>{load_time}s</strong> (ideale: &lt;3s)</li><li>Score performance: <strong>{performance_score}/100</strong></li></ul><p>Secondo Google, il 53% degli utenti abbandona un sito che impiega più di 3 secondi a caricarsi.</p><p>Posso ottimizzare il tuo sito e portare il tempo di caricamento sotto i 2 secondi.</p><p>Ti interessa una consulenza gratuita?</p><p>{your_name}</p>',
   'Ho fatto un test di velocità su {website}...',
   ARRAY['{website}', '{load_time}', '{performance_score}', '{your_name}'],
   true),

  (NULL, 'Follow-up 1', 'follow_up',
   'Re: Analisi {website}',
   '<p>Ciao,</p><p>Ti scrivo per un follow-up sulla mia email precedente riguardo {website}.</p><p>Ho notato che non hai ancora avuto modo di rispondere - capisco, siamo tutti impegnati!</p><p>Se ti fa comodo, ho disponibilità questa settimana per una breve call di 10 minuti. Ecco il mio calendario: {calendar_link}</p><p>Altrimenti, rispondimi pure quando hai un momento.</p><p>A presto,<br>{your_name}</p>',
   'Ti scrivo per un follow-up...',
   ARRAY['{website}', '{calendar_link}', '{your_name}'],
   true);

-- Indici
CREATE INDEX idx_email_templates_user ON email_templates(user_id);
CREATE INDEX idx_email_templates_category ON email_templates(category);
```

---

# RLS POLICIES (Row Level Security)

```sql
-- Credit purchases: utente vede solo i suoi
ALTER TABLE credit_purchases ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own credit purchases" ON credit_purchases
  FOR SELECT USING (auth.uid() = user_id);

-- Teams: owner e membri possono vedere
ALTER TABLE teams ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Team members can view team" ON teams
  FOR SELECT USING (
    owner_id = auth.uid() OR
    EXISTS (SELECT 1 FROM team_members WHERE team_id = teams.id AND user_id = auth.uid())
  );

-- Team members: membri del team possono vedere
ALTER TABLE team_members ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Team members can view members" ON team_members
  FOR SELECT USING (
    EXISTS (SELECT 1 FROM teams WHERE id = team_id AND owner_id = auth.uid()) OR
    EXISTS (SELECT 1 FROM team_members tm WHERE tm.team_id = team_members.team_id AND tm.user_id = auth.uid())
  );

-- Lead assignments: team members possono vedere
ALTER TABLE lead_assignments ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Team members can view assignments" ON lead_assignments
  FOR SELECT USING (
    EXISTS (SELECT 1 FROM team_members WHERE team_id = lead_assignments.team_id AND user_id = auth.uid())
  );

-- API Keys: solo proprietario
ALTER TABLE api_keys ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can manage own API keys" ON api_keys
  FOR ALL USING (user_id = auth.uid());

-- Webhooks: solo proprietario
ALTER TABLE webhooks ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can manage own webhooks" ON webhooks
  FOR ALL USING (user_id = auth.uid());

-- Outreach emails: solo proprietario
ALTER TABLE outreach_emails ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own outreach emails" ON outreach_emails
  FOR SELECT USING (user_id = auth.uid());

-- Notifications: solo proprietario
ALTER TABLE user_notifications ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own notifications" ON user_notifications
  FOR ALL USING (user_id = auth.uid());

-- Email templates: utente vede i suoi + quelli di sistema
ALTER TABLE email_templates ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own and system templates" ON email_templates
  FOR SELECT USING (user_id = auth.uid() OR user_id IS NULL);
CREATE POLICY "Users can manage own templates" ON email_templates
  FOR ALL USING (user_id = auth.uid());
```

---

# FILE DA CREARE

| File | Descrizione | Sprint |
|------|-------------|--------|
| `services/scraping-engine/src/pricing/pricing-engine.ts` | Generazione preventivi | 2 |
| `services/scraping-engine/src/outreach/email-generator.ts` | Template email | 3 |
| `apps/frontend-app/components/BulkActionsBar.tsx` | Barra azioni bulk | 1 |
| `apps/frontend-app/components/ExportDropdown.tsx` | Export multi-formato | 1 |
| `apps/frontend-app/components/SmartFiltersSidebar.tsx` | Filtri smart | 1 |
| `apps/frontend-app/components/ViewSwitcher.tsx` | Switch vista | 1 |
| `apps/frontend-app/components/NotificationCenter.tsx` | Notifiche | 5 |
| `apps/frontend-app/app/team/page.tsx` | Gestione team | 4 |
| `apps/frontend-app/app/credits/page.tsx` | Acquisto crediti | 0 |
| `apps/frontend-app/app/api/credits/purchase/route.ts` | API acquisto crediti | 0 |
| `apps/frontend-app/app/api/public/leads/route.ts` | API pubblica leads | 4 |
| `apps/frontend-app/app/api/outreach/send/route.ts` | Invio email outreach | 3 |
| `apps/frontend-app/app/api/webhooks/route.ts` | Gestione webhooks | 4 |

---

# FILE DA MODIFICARE

| File | Modifiche | Sprint |
|------|-----------|--------|
| `apps/frontend-app/app/dashboard/page.tsx` | Bulk actions, rich list, view switcher | 1 |
| `apps/frontend-app/app/lead/[id]/page.tsx` | Redesign, tab preventivo, competitors | 2 |
| `apps/frontend-app/app/api/webhook/route.ts` | Gestione credit pack purchase | 0 |
| `apps/frontend-app/components/Navbar.tsx` | Notification bell, credits display | 0, 5 |
| `apps/frontend-app/app/settings/page.tsx` | Sezione API keys, webhooks | 4 |
| `enhanced-website-analyzer.ts` | Aggiungere pricing/outreach data | 2 |

---

# NOTE TECNICHE

## Stripe Credit Packs
Per ogni pacchetto in `credit_packs`, creare un prodotto Stripe:
1. Andare su Stripe Dashboard > Products
2. Creare prodotto "Credit Pack - [Nome]"
3. Creare price one-time con importo
4. Copiare price_id e aggiornare tabella

## Email Service
- Usare Resend API (già configurato)
- Tracking pixel: `/api/track/open/[trackingId].gif`
- Click tracking: `/api/track/click/[trackingId]?url=[originalUrl]`

## Rate Limiting API
- Usare `@upstash/ratelimit` con Redis
- Default: 100 req/min per API key
- Risposta 429 se superato

---

# CRONOLOGIA AGGIORNAMENTI

| Data | Descrizione |
|------|-------------|
| 2026-01-23 | Creazione documento, piano completo |
| | Aggiunta sezione Credit Packs |
| | Query SQL complete |
| | Implementato API `/api/credits/purchase/route.ts` |
| | Implementato Frontend `/app/credits/page.tsx` |
| | Aggiornato Webhook per credit pack purchases |
| | Aggiunto link crediti in Navbar |
